<div class="overlay-container" *ngIf="visible" (click)="closeOverlay()">
  <!-- Backdrop with blur effect - conditionally applied based on mode -->
  <div class="overlay-backdrop" [class.navbar-only-blur]="searchGuideMode" [class.no-blur]="optionsGuideMode || payButtonGuideMode || (position && !searchGuideMode)"></div>
  
  <!-- Search Guide Message (shown when search guide mode is active) -->
  <div class="search-guide-message" *ngIf="searchGuideMode" (click)="$event.stopPropagation()">
    <div class="search-guide-content">
      <p class="search-guide-text">Scrivi il servizio che desideri</p>
    </div>
    <div class="search-guide-arrow">
      <svg class="arrow-icon-down" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <polyline points="19 12 12 19 5 12"></polyline>
      </svg>
    </div>
  </div>
  
  <!-- Giant Directional Arrows (shown in options guide mode or when scrolling needed) -->
  <div class="scroll-arrow-container" *ngIf="scrollDirection?.show || optionsGuideMode || payButtonGuideMode" (click)="$event.stopPropagation()">
    <!-- Down Arrow -->
    <div class="scroll-arrow scroll-arrow-down" *ngIf="scrollDirection?.direction === 'down' || optionsGuideMode || payButtonGuideMode">
      <svg class="arrow-icon" width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <polyline points="19 12 12 19 5 12"></polyline>
      </svg>
      <p class="arrow-text">{{ scrollDirection?.message }}</p>
    </div>
    
    <!-- Up Arrow -->
    <div class="scroll-arrow scroll-arrow-up" *ngIf="scrollDirection?.direction === 'up' && !optionsGuideMode && !payButtonGuideMode">
      <svg class="arrow-icon" width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
        <line x1="12" y1="19" x2="12" y2="5"></line>
        <polyline points="5 12 12 5 19 12"></polyline>
      </svg>
      <p class="arrow-text">{{ scrollDirection?.message }}</p>
    </div>
  </div>
  
  <!-- Highlight box around the focused element (only in form guide mode) -->
  <div 
    class="highlight-box" 
    *ngIf="position && !scrollDirection?.show && !optionsGuideMode && !searchGuideMode && !payButtonGuideMode"
    [ngStyle]="highlightStyle"
    (click)="$event.stopPropagation()"
  >
    <!-- Pulsing ring animation around the field -->
    <div class="highlight-pulse"></div>
  </div>
  
  <!-- Tooltip with help text (only in form guide mode) -->
  <div 
    class="tooltip-container" 
    *ngIf="position && position.helpText && !scrollDirection?.show && !optionsGuideMode && !searchGuideMode && !payButtonGuideMode"
    [ngStyle]="tooltipStyle"
    (click)="$event.stopPropagation()"
  >
    <div class="tooltip-arrow"></div>
    <div class="tooltip-content">
      <svg class="tooltip-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <path d="M12 16v-4"></path>
        <path d="M12 8h.01"></path>
      </svg>
      <p>{{ position.helpText }}</p>
    </div>
  </div>
  
  <!-- Close button -->
  <button class="close-button" (click)="closeOverlay()" aria-label="Chiudi guida">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="18" y1="6" x2="6" y2="18"></line>
      <line x1="6" y1="6" x2="18" y2="18"></line>
    </svg>
    <span>Chiudi Guida (ESC)</span>
  </button>
</div>
